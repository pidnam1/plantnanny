<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3"
      crossorigin="anonymous"
    />
    <link rel="stylesheet" href="styles.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Rubik+Moonrocks&display=swap"
      rel="stylesheet"
    />
    <title>Plant Nanny</title>
  </head>
  <body>
    <nav class="navbar navbar-light" id="topHeader">
      <div class="container">
        <div class="row">
          <div class="col-12" id="title">The Plant Nanny</div>
        </div>
      </div>
    </nav>

    <div id="main">
      <div class="container">
        <div class="row" id="part1">
          <div class="col-4">
            <div class="plantDisplay">
              <img src="spiderplant.jpg" class="rounded-circle" alt="Plant image" />
              <div class="card mt-2" id="name">Plant Name: Poppy</div>
            </div>
          </div>

          <div class="col-8">
            <div class="current-status">
              <h5 id="statusHeader">Here is Poppy's current health...</h5>
              <div class="card-group">
                <div class="col">
                  <div class="card border-danger h-100" id="measurementCard">
                    <h1 id="temperature">72 F</h1>
                    Temperature
                  </div>
                </div>
                <div class="col">
                  <div class="card border-warning h-100" id="measurementCard">
                    <h1 id="light">84%</h1>
                    Light Level
                  </div>
                </div>
                <div class="col">
                  <div class="card border-success h-100" id="measurementCard">
                    <h1 id="moisture">33%</h1>
                    Soil Moisture
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="row mt-5" id="part2">
          <div class="col-4">
            <div class="feelingSection">
              <h5 id="feelingTitle">Poppy is feeling...</h5>
              <div class="card mt-2" id="feeling">Thirsty</div>
            </div>
            <div class="care mt-4">
              <h5 id="careTitle">Poppy's Care:</h5>
              <ul class="list-group">
                <li class="list-group-item">Temperature:</li>
                <li class="list-group-item">Light Level:</li>
                <li class="list-group-item">Soil Moisture:</li>
              </ul>
              <br />
              <button type="button" class="btn" id="updateButton">Update Profile</button>
            </div>
          </div>
          <div class="col-8">
            <div class="sensorSection">
              <h5 id="sensorHeader">Sensor Readings</h5>
              <div class="chart-container" style="position: relative; width: 50vw; margin: auto">
                <canvas id="myChart"></canvas>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Optional JavaScript; choose one of the two! -->
    <!-- Option 1: Bootstrap Bundle with Popper -->
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
      crossorigin="anonymous"
    ></script>
    <link href="https://fonts.googleapis.com/css?family=Lato" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.4.0/Chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.0.4/socket.io.js"></script>
    <script>
      var socket = io.connect("http://localhost:5000"); //connect to server

      var ctx = document.getElementById("myChart").getContext("2d");
      var chart = new Chart(ctx, {
        // The type of chart we want to create
        type: "line",

        // The data for our dataset
        data: {
          labels: [],
          datasets: [
            {
              label: "Temperature",
              borderColor: "#FF5733",
              data: [],
              fill: false,
              pointStyle: "circle",
              backgroundColor: "#3498DB",
              pointRadius: 5,
              pointHoverRadius: 7,
              lineTension: 0,
            },
          ],
        },

        // Configuration options go here
        options: {},
      });

      socket.on("temp", function (data) {
        //As a temp data is received
        console.log(data.temp);
        console.log(data.time);
        //document.getElementById("date").innerHTML = data.date; //update the date
        if (chart.data.labels.length != 15) {
          //If we have less than 15 data points in the graph
          chart.data.labels.push(data.time); //Add time in x-asix
          chart.data.datasets.forEach((dataset) => {
            dataset.data.push(data.temp); //Add temp in y-axis
          });
        } else {
          //If there are already 15 data points in the graph.
          chart.data.labels.shift(); //Remove first time data
          chart.data.labels.push(data.time); //Insert latest time data
          chart.data.datasets.forEach((dataset) => {
            dataset.data.shift(); //Remove first temp data
            dataset.data.push(data.temp); //Insert latest temp data
          });
        }
        chart.update(); //Update the graph.
      });
    </script>
  </body>
</html>
