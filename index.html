<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3"
      crossorigin="anonymous"
    />
    <link rel="stylesheet" href="styles.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Rubik+Moonrocks&display=swap"
      rel="stylesheet"
    />
    <link href='https://fonts.googleapis.com/css?family=Poppins' rel='stylesheet'>
    <title>Plant Nanny</title>
  </head>
  <body>
    <nav class="navbar navbar-light" id="topHeader">
      <div class="container">
        <div class="row">
          <div class="col-12" id="title">The Plant Nanny</div>
        </div>
      </div>
    </nav>

    <div id="main">
      <div class="container">
        <div class="row" id="part1">
          <div class="col-2">
            <div class="plantDisplay">
              <img src="pinkpolka.jpg" class="rounded-circle" alt="Plant image" />
              <div class="card mt-2" id="name">Plant Name: Poppy</div>
            </div>
          </div>

          <div class="col-8">
            <div class="current-status">
              <h5 id="statusHeader">Here is Poppy's current health...</h5>
              <div class="card-group">
                <div class="col">
                  <div class="card care_cards" id="measurementCard">
                    <h1 id="temperature">72 °F</h1>
                    Temperature
                  </div>
                </div>
                <div class="col">
                  <div class="card care_cards" id="measurementCard">
                    <h1 style="align-content: center" id="light">84%</h1>
                    Light Level
                  </div>
                </div>
                <div class="col">
                  <div class="card care_cards" id="measurementCard">
                    <h1 id="moisture">33%</h1>
                    Soil Moisture
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="row mt-5" id="part2">
          <div class="col-2">
            <div class="feelingSection">
              <h6 id="feelingTitle">Poppy is feeling...</h5>
              <div class="card mt-2" id="feeling">Healthy</div>
            </div>
            <div class="care mt-4">

              <h6 id="careTitle">Poppy's Care:</h5>
              <ul class="list-group">
                <li id = "list_temp" data-value="a" class="list-group-item care_bars">Temperature:</li>
                <li id = "list_light" class="list-group-item care_bars">Light Level%:</li>
                <li id = "list_soil" class="list-group-item care_bars">Soil Moisture%:</li>
              </ul>
              <br />
              <button type="button" class="btn modal-open" data-id="demo-modal" id="updateButton">Update Profile</button>
              <div id="demo-modal" class="modal" role="dialog" tabindex="-1">
                <div class="model-inner">
                  <div class="modal-header">
                    <h3>Update Information</h3>
                    <button class="modal-close" data-id="demo-modal" aria-label="Close">&times;
                    </button>
                    </div>
                    <div class="form-group" style="text-align:center;">
                        <form name="form_name" action="/" id="form_id" method="POST" class="form_class" >
                          <label>Temperature Min:</label>
                          <input type="text" name="temperature_input" id="temperature_input_min" placeholder="Temperature Min" />
                          <label>Temperature Max:</label>
                          <input type="text" name="temperature_input" id="temperature_input_max" placeholder="Temperature Max" />
                          <label>Light Level Min%:</label>
                          <input type="text" name="light_input" id="light_input_min" placeholder="Light Level" />
                          <label>Light Level Max%:</label>
                          <input type="text" name="light_input" id="light_input_max" placeholder="Light Level" />
                          <label>Soil Moisture Min%:</label>
                          <input type="text" name="soil_input" id="soil_input_min" placeholder="Soil Moisture" />
                          <label>Soil Moisture Max%:</label>
                          <input type="text" name="soil_input" id="soil_input_max" placeholder="Soil Moisture" />
                          <button type ="submit" class = "submit_values"data-id="modal_button">Submit</button>
                        </form>
                        
                      </div>
                     
                </div>
              </div>
            </div>
          </div>
          <div class="col-8">
            <div class="sensorSection">
              <h5 id="sensorHeader">Sensor Readings</h5>
              <div class="chart-container" style="position: relative; width: 50vw; margin: auto">
                <canvas id="myChart"></canvas>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Optional JavaScript; choose one of the two! -->
    <!-- Option 1: Bootstrap Bundle with Popper -->
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
      crossorigin="anonymous"
    ></script>
    <link href="https://fonts.googleapis.com/css?family=Lato" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.4.0/Chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.0.4/socket.io.js"></script>
    <script>
      var socket = io.connect("http://localhost:5000"); //connect to server

      var ctx = document.getElementById("myChart").getContext("2d");
      var chart = new Chart(ctx, {
        // The type of chart we want to create
        type: "line",

        // The data for our dataset
        data: {
          labels: [],
          datasets: [
            {
              label: 'Temperature',
              yAxisID: 'A',
              borderColor: "#FF5733",
              data: [],
              fill: false,
              pointStyle: "circle",
              backgroundColor: "#3498DB",
              pointRadius: 5,
              pointHoverRadius: 7,
              lineTension: 0,
            },
            {
              label: 'Light Level',
              yAxisID: 'B',
              borderColor: "#FG5733",
              data: [],
              fill: false,
              pointStyle: "circle",
              backgroundColor: "#FFFFFF",
              pointRadius: 5,
              pointHoverRadius: 7,
              lineTension: 0,
            },
            {
              label: 'Soil Moisture',
              yAxisID: 'B',
              borderColor: "#FGHEQ",
              data: [],
              fill: false,
              pointStyle: "circle",
              backgroundColor: "#HERYT",
              pointRadius: 5,
              pointHoverRadius: 7,
              lineTension: 0,
            }
          ],
        },

        // Configuration options go here
        options: {
          responsive : true,
      tooltips : {
        callbacks : {
          title : function() {
            return 'More information:';
          },
        }
      },
    scales: {
      yAxes: [{
        id: 'A',
        type: 'linear',
        position: 'left',
        scaleLabel: {
        display: true,
        labelString: 'Temperature(°F)'
      },
        ticks: {
          max: 100,
          min: 0
        }
      }, {
        id: 'B',
        type: 'linear',
        position: 'right',
        scaleLabel: {
        display: true,
        labelString: 'Percent(%)'
      },
        ticks: {
          max: 100,
          min: 0
        }
      }]
    }
  }
      });

      socket.on("temp", function (data) {
        //As a temp data is received
        //console.log(data.temp);
        //console.log(data.time);
        document.getElementById("temperature").innerHTML = data.temp.toString() + "°F";
        document.getElementById("light").innerHTML = data.light.toString() + "%";
        document.getElementById("moisture").innerHTML = data.soil.toString() + "%";

        
        //update_status(); // updates if poppy is thirsty, hot, cold, etc
        
        const max_value = Math.max(data.norm_temp, data.norm_light, data.norm_soil);
        console.log(max_value);
        const min_value = Math.min(data.norm_temp, data.norm_light, data.norm_soil);
        console.log(min_value);
        const not_healthy = Math.abs(min_value) > 0.5 || Math.abs(max_value) > 0.5;
        if(Math.abs(min_value) > Math.abs(max_value) && not_healthy){
          switch(min_value){
            case data.norm_temp:
              document.getElementById("feeling").innerHTML = "Cold";
              break;
            case data.norm_light:
              document.getElementById("feeling").innerHTML = "Shady";
              break;
            case data.norm_soil:
              document.getElementById("feeling").innerHTML = "Dry";
          }
        }
        else if(Math.abs(max_value) > Math.abs(min_value) && not_healthy){
          switch(max_value){
            case data.norm_temp:
              document.getElementById("feeling").innerHTML = "Hot";
              break;
            case data.norm_light:
              document.getElementById("feeling").innerHTML = "Sunny";
              break;
            case data.norm_soil:
              document.getElementById("feeling").innerHTML = "Wet";
          }
        } else{
          document.getElementById("feeling").innerHTML = "Healthy";
        }

        if (chart.data.labels.length != 15) {
          //If we have less than 15 data points in the graph
          chart.data.labels.push(data.time); //Add time in x-asix
          chart.data.datasets[0].data.push((data.temp));
          chart.data.datasets[1].data.push((data.light));
          chart.data.datasets[2].data.push((data.soil));
         //Add temp in y-axis
         
        } else {
          //If there are already 15 data points in the graph.
          chart.data.labels.shift(); //Remove first time data
          chart.data.labels.push(data.time); //Insert latest time data
          chart.data.datasets[0].data.push((data.temp));
          chart.data.datasets[1].data.push((data.light));
          chart.data.datasets[2].data.push((data.soil));
        }
        chart.update(); //Update the graph.
      });

      // function update_status(){
      //   let temp_range = document.getElementById("list_temp").innerHTML;
      //   let curr_min_temp = temp_range.slice(13, 15);
      //   let curr_max_temp  = temp_range.slice(17);
      //   console.log(curr_min_temp);
      //   console.log(curr_max_temp);

      //   let light_range = document.getElementById("list_light").innerHTML;
      //   let curr_min_light = light_range.slice(14, 16);
      //   let curr_max_light  = light_range.slice(18);
      //   console.log(curr_min_light);
      //   console.log(curr_max_light);

      //   let soil_range = document.getElementById("list_soil").innerHTML;
      //   let curr_min_soil = soil_range.slice(16, 19);
      //   let curr_max_soil  = soil_range.slice(21);
      //   console.log(curr_min_soil);
      //   console.log(curr_max_soil);

      //   const none_empty = !(curr_min_temp === "" || curr_max_temp === "" || curr_min_light === "" || curr_max_light === "" || curr_min_soil === "" || curr_max_soil === "")

      //   if (none_empty){
      //     curr_min_temp = parseInt(curr_min_temp);
      //     curr_max_temp = parseInt(curr_max_temp);
      //     curr_min_light = parseInt(curr_min_light);
      //     curr_max_light = parseInt(curr_max_light);
      //     curr_min_soil = parseInt(curr_min_soil);
      //     curr_max_soil = parseInt(curr_max_soil);





      //   }
      // }
    </script>
 <script src="modal.js"></script> 
 

  </body>
</html>
